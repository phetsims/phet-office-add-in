/*!
 * Labs.js JavaScript API for Office Mix
 * Version: 1.0.5 * Copyright (c) Microsoft Corporation.  All rights reserved.
 * Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.
 */
var Labs;!function(a){var b;!function(a){}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){!function(a){a[a.Edit=0]="Edit",a[a.View=1]="View"}(a.LabMode||(a.LabMode={}));a.LabMode}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(){}return a.Edit="Labs.Permissions.Edit",a.Take="Labs.Permissions.Take",a}();a.Permissions=b}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.CloseComponentAction="Labs.Core.Actions.CloseComponentAction"}(b=a.Actions||(a.Actions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.CreateAttemptAction="Labs.Core.Actions.CreateAttemptAction"}(b=a.Actions||(a.Actions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.CreateComponentAction="Labs.Core.Actions.CreateComponentAction"}(b=a.Actions||(a.Actions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.AttemptTimeoutAction="Labs.Core.Actions.AttemptTimeoutAction"}(b=a.Actions||(a.Actions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.GetValueAction="Labs.Core.Actions.GetValueAction"}(b=a.Actions||(a.Actions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.ResumeAttemptAction="Labs.Core.Actions.ResumeAttemptAction"}(b=a.Actions||(a.Actions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.SubmitAnswerAction="Labs.Core.Actions.SubmitAnswerAction"}(b=a.Actions||(a.Actions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.GetComponentActions="Labs.Core.GetActions.GetComponentActions"}(b=a.GetActions||(a.GetActions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b;!function(a){a.GetAttempt="Labs.Core.GetActions.GetAttempt"}(b=a.GetActions||(a.GetActions={}))}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){a.TimelineNextMessageType="Labs.Message.Timeline.Next"}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function a(){}return a.prototype.attach=function(a,b){this._id=a,this._labs=b},a}();a.ComponentInstanceBase=b}(Labs||(Labs={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Labs;!function(a){var b=function(b){function c(){b.call(this)}return __extends(c,b),c.prototype.createAttempt=function(b){var c=this,d=this.getCreateAttemptOptions();this._labs.takeAction(a.Core.Actions.CreateAttemptAction,d,function(a,d){var e=null;if(!a)try{e=c.buildAttempt(d)}catch(f){a=f}setTimeout(function(){return b(a,e)},0)})},c.prototype.getAttempts=function(b){var c=this,d={componentId:this._id,action:a.Core.Actions.CreateAttemptAction};this._labs.getActions(a.Core.GetActions.GetComponentActions,d,function(a,d){var e=null;a||(e=d.map(function(a){return c.buildAttempt(a)})),setTimeout(function(){return b(null,e)},0)})},c.prototype.getCreateAttemptOptions=function(){var a={componentId:this._id};return a},c.prototype.buildAttempt=function(a){throw"Not implemented"},c}(a.ComponentInstanceBase);a.ComponentInstance=b}(Labs||(Labs={}));var Labs;!function(a){!function(a){a[a.Disconnected=0]="Disconnected",a[a.Connecting=1]="Connecting",a[a.Connected=2]="Connected"}(a.ConnectionState||(a.ConnectionState={}));a.ConnectionState}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function a(){this._handlers={}}return a.prototype.getHandler=function(a){var b=this._handlers[a];return void 0===b&&(this._handlers[a]=[]),this._handlers[a]},a.prototype.add=function(a,b){var c=this.getHandler(a);c.push(b)},a.prototype.remove=function(a,b){for(var c=this.getHandler(a),d=c.length-1;d>=0;d--)c[d]===b&&c.splice(d,1)},a.prototype.fire=function(a,b){var c=this.getHandler(a);c.forEach(function(a){a(b)})},a}();a.EventManager=b}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function a(a,b){this._labsInternal=a,this._doneCallback=b}return a.Create=function(b,c,d){if(b.isCreated()){var e=new a(b,c);setTimeout(function(){return d(null,e)},0)}else b.create(function(e,f){if(e)return void setTimeout(function(){return d(e,null)},0);var g=new a(b,c);setTimeout(function(){return d(null,g)},0)})},a.prototype.getConfiguration=function(a){this._labsInternal.getConfiguration(a)},a.prototype.setConfiguration=function(a,b){this._labsInternal.setConfiguration(a,b)},a.prototype.done=function(a){this._doneCallback(),this._doneCallback=null,setTimeout(function(){return a(null,null)},0)},a}();a.LabEditor=b}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function b(a,b,c,d){this._labsInternal=a,this.components=b,this._doneCallback=c,this.data=d}return b.Create=function(c,d,e){c.getConfigurationInstance(function(f,g){if(f)return void setTimeout(function(){return e(f,null)},0);if(!g)return void setTimeout(function(){return e("No configuration set",null)},0);var h=g.components.map(function(b){var d=a.deserialize(b);return d.attach(b.componentId,c),d}),i=new b(c,h,d,g.data);setTimeout(function(){return e(null,i)},0)})},b.prototype.getState=function(a){this._labsInternal.getState(a)},b.prototype.setState=function(a,b){this._labsInternal.setState(a,b)},b.prototype.done=function(a){this._doneCallback(),this._doneCallback=null,setTimeout(function(){return a(null,null)},0)},b}();a.LabInstance=b}(Labs||(Labs={}));var Labs;!function(a){function b(b,c){if(0!==r)throw"connect has previously been called";var d,e=void 0===c?b:c,f=void 0===c?a.DefaultHostBuilder():b;try{d=new a.LabsInternal(f)}catch(g){return void setTimeout(function(){return e(g,null)},0)}r=1,d.connect(function(b,c){b?(r=0,o=null,p=null):(r=2,o=d,p=c,q=new a.Timeline(o)),setTimeout(function(){e(b,c),d.firePendingMessages()},0)})}function c(){return 2===r}function d(){return n(),p}function e(){n(),o.dispose(),o=null,q=null,t=null,u=null,r=0}function f(b){return n(),null!==t?void setTimeout(function(){return b("Lab is being taken",null)}):null!==u?void setTimeout(function(){return b("Lab edit already in progress",null)}):void a.LabEditor.Create(o,function(){u=null},function(a,c){u=a?null:c,setTimeout(function(){return b(a,c)},0)})}function g(b){return n(),null!==u?void setTimeout(function(){return b("Lab is being edited",null)}):null!==t?void setTimeout(function(){return b("Lab already in progress",null)}):void a.LabInstance.Create(o,function(){t=null},function(a,c){t=a?null:c,setTimeout(function(){return b(a,c)},0)})}function h(a,b){n(),o.on(a,b)}function i(a,b){n(),o.off(a,b)}function j(){return n(),q}function k(a,b){if(a in s)throw"Type already has a create function registered";s[a]=b}function l(a){if(!(a.type in s))throw"Unknown type";return s[a.type](a)}function m(){return o.getLanguage()}function n(){if(2!=r)throw"API not initialized"}var o,p,q,r=0,s={},t=null,u=null;a.DefaultHostBuilder,a.connect=b,a.isConnected=c,a.getConnectionInfo=d,a.disconnect=e,a.editLab=f,a.takeLab=g,a.on=h,a.off=i,a.getTimeline=j,a.registerDeserializer=k,a.deserialize=l,a.getLanguage=m}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){a[a.None=0]="None",a[a.Initialized=1]="Initialized",a[a.Disposed=2]="Disposed"}(b||(b={}));var c=function(){function b(b){this._state=0,this._eventManager=new a.EventManager,this._hostVersion=null,this._queuePendingMessages=!0,this._pendingMessages=[],this._created=!1;for(var c=b.getSupportedVersions(),d=!1,e=0;e<c.length;e++)0===c[e].version.major&&c[e].version.minor<=1&&(d=!0);if(!d)throw"Unsupported host version";this._labHost=b}return b.prototype.connect=function(a){var b=this;if(0!==this._state)throw"Already initialized";this._labHost.connect(this._labHost.getSupportedVersions().splice(0),function(c,d){c||(b._state=1,b._hostVersion=d.hostVersion,b._createInfo=d.initializationInfo,b._language=b._labHost.getLanguage(),b._labHost.on(function(a,c){b._queuePendingMessages?b._pendingMessages.push({message:a,messageData:c}):b._eventManager.fire(a,c)})),setTimeout(function(){return a(c,d)},0)})},b.prototype.firePendingMessages=function(){var a=this;this._queuePendingMessages=!1,this._pendingMessages.forEach(function(b){a._eventManager.fire(b.message,b.messageData)}),this._pendingMessages=[]},b.prototype.create=function(a){var b=this;this.checkIsInitialized(),this._labHost.create({},function(c,d){b._createInfo={hostVersion:b._hostVersion},setTimeout(function(){return a(c,d)})})},b.prototype.isCreated=function(){return this.checkIsInitialized(),null!==this._createInfo},b.prototype.dispose=function(){this.checkIsInitialized(),this._state=2,this._labHost.disconnect(function(a,b){a&&console.error("Labs.js: Error disconnecting from host.")})},b.prototype.on=function(a,b){this.checkIsInitialized(),this._eventManager.add(a,b)},b.prototype.sendMessage=function(a,b,c){this.checkIsInitialized(),this._labHost.sendMessage(a,b,c)},b.prototype.off=function(a,b){this.checkIsInitialized(),this._eventManager.remove(a,b)},b.prototype.getState=function(a){this.checkIsInitialized(),this._labHost.getState(a)},b.prototype.setState=function(a,b){this.checkIsInitialized(),this._labHost.setState(a,b)},b.prototype.getConfiguration=function(a){this.checkIsInitialized(),this._labHost.getConfiguration(a)},b.prototype.setConfiguration=function(a,b){this.checkIsInitialized(),this._labHost.setConfiguration(a,b)},b.prototype.getConfigurationInstance=function(a){this.checkIsInitialized(),this._labHost.getConfigurationInstance(a)},b.prototype.takeAction=function(a,b,c,d){this.checkIsInitialized(),void 0!==d?this._labHost.takeAction(a,b,c,d):this._labHost.takeAction(a,b,c)},b.prototype.getActions=function(a,b,c){this.checkIsInitialized(),this._labHost.getActions(a,b,c)},b.prototype.getLanguage=function(){return this._labHost.getLanguage()},b.prototype.checkIsInitialized=function(){if(1!==this._state)throw"Not initialized"},b}();a.LabsInternal=c}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function b(a){this._labsInternal=a}return b.prototype.next=function(b,c){var d={status:b};this._labsInternal.sendMessage(a.TimelineNextMessageType,d,function(a,b){setTimeout(function(){return c(a,null)},0)})},b}();a.Timeline=b}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function b(a,b,c,d,e,f,g,h){this._componentId=a,this._attemptId=b,this.id=c,this._labs=d,this.isHint=e,this.hasBeenRequested=f,this.hasValue=g,this.value=h}return b.prototype.getValue=function(b){var c=this;if(this.hasValue&&this.hasBeenRequested)return void setTimeout(function(){return b(null,c.value)},0);var d={componentId:this._componentId,attemptId:this._attemptId,valueId:this.id,isHint:this.isHint};this._labs.takeAction(a.Core.Actions.GetValueAction,d,function(a,d){if(!a){var e=d.result;c.value=e.value,c.hasValue=!0,c.hasBeenRequested=!0}setTimeout(function(){return b(a,c.value)},0)})},b.prototype.provideValue=function(a){this.value=a,this.hasValue=!0,this.hasBeenRequested=!0},b}();a.ValueHolder=b}(Labs||(Labs={}));var Labs;!function(a){var b;!function(b){var c=function(){function b(b,c,d,e){this._resumed=!1,this._state=0,this._values={},this._labs=b,this._id=d,this._componentId=c;for(var f in e){for(var g=[],h=e[f],i=0;i<h.length;i++){var j=h[i];g.push(new a.ValueHolder(this._componentId,this._id,j.valueId,this._labs,j.isHint,!1,j.hasValue,j.value))}this._values[f]=g}}return b.prototype.verifyResumed=function(){if(!this._resumed)throw"Attempt has not yet been resumed"},b.prototype.isResumed=function(){return this._resumed},b.prototype.resume=function(b){var c=this;if(this._resumed)throw"Already resumed";var d={attemptId:this._id};this._labs.getActions(a.Core.GetActions.GetAttempt,d,function(a,d){return a?void setTimeout(function(){return b(a,null)},0):(c.resumeCore(d),void c.sendResumeAction(function(d,e){d||(c._resumed=!0),setTimeout(function(){return b(a,e)})}))})},b.prototype.sendResumeAction=function(b){var c={componentId:this._componentId,attemptId:this._id};this._labs.takeAction(a.Core.Actions.ResumeAttemptAction,c,function(a,c){setTimeout(function(){return b(a,null)},0)})},b.prototype.resumeCore=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.processAction(c)}},b.prototype.getState=function(){return this._state},b.prototype.processAction=function(b){b.type===a.Core.Actions.GetValueAction?this.useValue(b):b.type==a.Core.Actions.AttemptTimeoutAction&&(this._state=1)},b.prototype.getValues=function(a){return this.verifyResumed(),this._values[a]},b.prototype.useValue=function(a){var b=a.options,c=a.result,d=b.valueId;for(var e in this._values)for(var f=this._values[e],g=0;g<f.length;g++)f[g].id===d&&f[g].provideValue(c.value)},b}();b.ComponentAttempt=c}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Labs;!function(a){var b;!function(b){var c=function(b){function c(a,c,d,e){b.call(this,a,c,d,e)}return __extends(c,b),c.prototype.complete=function(b){var c=this,d={componentId:this._componentId,attemptId:this._id,answer:null};this._labs.takeAction(a.Core.Actions.SubmitAnswerAction,d,null,function(a,d){return a?void setTimeout(function(){return b(a,null)},0):(c._state=2,void setTimeout(function(){return b(null,null)},0))})},c.prototype.processAction=function(c){c.type===a.Core.Actions.SubmitAnswerAction?this._state=2:c.type===a.Core.Actions.GetValueAction&&b.prototype.processAction.call(this,c)},c}(b.ComponentAttempt);b.ActivityComponentAttempt=c}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(b){b.ActivityComponentInstanceType="Labs.Components.ActivityComponentInstance";var c=function(a){function c(b){a.call(this),this.component=b}return __extends(c,a),c.prototype.buildAttempt=function(a){var c=a.result.attemptId;return new b.ActivityComponentAttempt(this._labs,this.component.componentId,c,this.component.values)},c}(a.ComponentInstance);b.ActivityComponentInstance=c,a.registerDeserializer(b.ActivityComponentInstanceType,function(a){return new c(a)})}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(a){this.answer=a}return a}();a.ChoiceComponentAnswer=b}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e){c.call(this,a,b,d,e),this._submissions=[]}return __extends(d,c),d.prototype.timeout=function(b){var c=this;this._labs.takeAction(a.Core.Actions.AttemptTimeoutAction,{attemptId:this._id},function(a,d){a||(c._state=1),setTimeout(function(){return b(a,null)},0)})},d.prototype.getSubmissions=function(){return this.verifyResumed(),this._submissions},d.prototype.submit=function(b,c,d){var e=this;this.verifyResumed();var f={componentId:this._componentId,attemptId:this._id,answer:b.answer},g={submissionId:null,complete:c.complete,score:c.score};this._labs.takeAction(a.Core.Actions.SubmitAnswerAction,f,g,function(a,b){if(a)return void setTimeout(function(){return d(a,null)},0);var c=e.storeSubmission(b);setTimeout(function(){return d(null,c)},0)})},d.prototype.processAction=function(b){b.type===a.Core.Actions.SubmitAnswerAction?this.storeSubmission(b):c.prototype.processAction.call(this,b)},d.prototype.storeSubmission=function(a){var c=a.options,d=a.result;d.complete&&(this._state=2);var e=new b.ChoiceComponentSubmission(new b.ChoiceComponentAnswer(c.answer),new b.ChoiceComponentResult(d.score,d.complete),a.time);return this._submissions.push(e),e},d}(b.ComponentAttempt);b.ChoiceComponentAttempt=c}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(b){b.ChoiceComponentInstanceType="Labs.Components.ChoiceComponentInstance";var c=function(a){function c(b){a.call(this),this.component=b}return __extends(c,a),c.prototype.buildAttempt=function(a){var c=a.result.attemptId;return new b.ChoiceComponentAttempt(this._labs,this.component.componentId,c,this.component.values)},c}(a.ComponentInstance);b.ChoiceComponentInstance=c,a.registerDeserializer(b.ChoiceComponentInstanceType,function(a){return new c(a)})}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(b){b.DynamicComponentInstanceType="Labs.Components.DynamicComponentInstance";var c=function(b){function c(a){b.call(this),this.component=a}return __extends(c,b),c.prototype.getComponents=function(b){var c=this,d={componentId:this._id,action:a.Core.Actions.CreateComponentAction};this._labs.getActions(a.Core.GetActions.GetComponentActions,d,function(a,d){var e=d.map(function(a){return c.createComponentInstance(a)});setTimeout(function(){return b(null,e)},0)})},c.prototype.createComponent=function(b,c){var d=this,e={componentId:this._id,component:b};this._labs.takeAction(a.Core.Actions.CreateComponentAction,e,function(a,b){var e=null;a||(e=d.createComponentInstance(b)),setTimeout(function(){return c(a,e)},0)})},c.prototype.createComponentInstance=function(b){var c=b.result.componentInstance,d=a.deserialize(c);return d.attach(c.componentId,this._labs),d},c.prototype.close=function(b){var c=this;this.isClosed(function(d,e){if(d)return void setTimeout(function(){return b(d,null)});var f={componentId:c._id};c._labs.takeAction(a.Core.Actions.CloseComponentAction,f,null,function(a,c){setTimeout(function(){return b(a,null)})})})},c.prototype.isClosed=function(b){var c={componentId:this._id,action:a.Core.Actions.CloseComponentAction};this._labs.getActions(a.Core.GetActions.GetComponentActions,c,function(a,c){if(a)setTimeout(function(){return b(a,null)},0);else{var d=c.length>0;setTimeout(function(){return b(null,d)},0)}})},c}(a.ComponentInstanceBase);b.DynamicComponentInstance=c,a.registerDeserializer(b.DynamicComponentInstanceType,function(a){return new c(a)})}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){a.ActivityComponentType="Labs.Components.ActivityComponent"}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){a.ChoiceComponentType="Labs.Components.ChoiceComponent"}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){a.Infinite=-1,a.DynamicComponentType="Labs.Components.DynamicComponent"}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){a.InputComponentType="Labs.Components.InputComponent"}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(a){this.answer=a}return a}();a.InputComponentAnswer=b}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e){c.call(this,a,b,d,e),this._submissions=[]}return __extends(d,c),d.prototype.processAction=function(b){b.type===a.Core.Actions.SubmitAnswerAction?this.storeSubmission(b):c.prototype.processAction.call(this,b)},d.prototype.getSubmissions=function(){return this.verifyResumed(),this._submissions},d.prototype.submit=function(b,c,d){var e=this;this.verifyResumed();var f={componentId:this._componentId,attemptId:this._id,answer:b.answer},g={submissionId:null,complete:c.complete,score:c.score};this._labs.takeAction(a.Core.Actions.SubmitAnswerAction,f,g,function(a,b){if(a)return void setTimeout(function(){return d(a,null)},0);var c=e.storeSubmission(b);setTimeout(function(){return d(null,c)},0)})},d.prototype.storeSubmission=function(a){var c=a.options,d=a.result;d.complete&&(this._state=2);var e=new b.InputComponentSubmission(new b.InputComponentAnswer(c.answer),new b.InputComponentResult(d.score,d.complete),a.time);return this._submissions.push(e),e},d}(b.ComponentAttempt);b.InputComponentAttempt=c}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(b){b.InputComponentInstanceType="Labs.Components.InputComponentInstance";var c=function(a){function c(b){a.call(this),this.component=b}return __extends(c,a),c.prototype.buildAttempt=function(a){var c=a.result.attemptId;return new b.InputComponentAttempt(this._labs,this.component.componentId,c,this.component.values)},c}(a.ComponentInstance);b.InputComponentInstance=c,a.registerDeserializer(b.InputComponentInstanceType,function(a){return new c(a)})}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(a,b){this.score=a,this.complete=b}return a}();a.InputComponentResult=b}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this.answer=a,this.result=b,this.time=c}return a}();a.InputComponentSubmission=b}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){!function(a){a[a.InProgress=0]="InProgress",a[a.Timeout=1]="Timeout",a[a.Completed=2]="Completed"}(a.ProblemState||(a.ProblemState={}));a.ProblemState}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(a,b){this.score=a,this.complete=b}return a}();a.ChoiceComponentResult=b}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this.answer=a,this.result=b,this.time=c}return a}();a.ChoiceComponentSubmission=b}(b=a.Components||(a.Components={}))}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function a(a,b){this.type=a,this.commandData=b}return a}();a.Command=b}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){a.Connect="connect",a.Disconnect="disconnect",a.Create="create",a.GetConfigurationInstance="getConfigurationInstance",a.TakeAction="takeAction",a.GetCompletedActions="getCompletedActions",a.ModeChanged="modeChanged",a.GetConfiguration="getConfiguration",a.SetConfiguration="setConfiguratoin",a.GetState="getState",a.SetState="setState",a.SendMessage="sendMessage"}(b=a.CommandType||(a.CommandType={}))}(Labs||(Labs={}));var Labs;!function(a){var b;!function(a){var b=function(){function a(){}return a.ModeChanged="modeChanged",a.Activate="activate",a.Deactivate="deactivate",a}();a.EventTypes=b}(b=a.Core||(a.Core={}))}(Labs||(Labs={}));var Labs;!function(a){!function(a){a[a.Message=0]="Message",a[a.Completion=1]="Completion",a[a.Failure=2]="Failure"}(a.MessageType||(a.MessageType={}));var b=(a.MessageType,function(){function a(a,b,c,d){this.id=a,this.labId=b,this.type=c,this.payload=d}return a}());a.Message=b;var c=function(){function a(a,b,c){this._labId=a,this.isStarted=!1,this.nextMessageId=0,this.targetOrigin=b,this.messageHandler=c,this.messageMap={}}return a.prototype.throwIfNotStarted=function(){if(!this.isStarted)throw"Processor has not been started"},a.prototype.getNextMessageId=function(){return this.nextMessageId++},a.prototype.parseOrigin=function(a){var b=document.createElement("a");return b.href=a,b.protocol+"//"+b.host},a.prototype.listener=function(a){var c,d,e=this,f=a;try{d=JSON.parse(f.data)}catch(g){return}if(d.labId===this._labId)if(1===d.type)c=this.messageMap[d.id],delete this.messageMap[d.id],c.origin===f.source&&c.callback(null,d.payload);else if(2===d.type)c=this.messageMap[d.id],delete this.messageMap[d.id],c.origin===f.source&&c.callback({error:d.payload},null);else{if(0!=d.type)throw"Unknown message type";this.messageHandler(f.source,d.payload,function(a,c){var g=new b(d.id,e._labId,a?2:1,c);try{e.postMessage(f.source,g)}catch(h){}})}},a.prototype.postMessage=function(a,b){if(!a)throw"Unknown target window";a.postMessage(JSON.stringify(b),this.targetOrigin)},a.prototype.start=function(){var a=this;if(this.isStarted)throw"Processor already running";this.eventListener=function(b){a.listener(b)},window.addEventListener("message",this.eventListener),this.isStarted=!0},a.prototype.stop=function(){this.throwIfNotStarted(),window.removeEventListener("message",this.eventListener),this.isStarted=!1},a.prototype.sendMessage=function(a,c,d){this.throwIfNotStarted();var e=this.getNextMessageId(),f=new b(e,this._labId,0,c);try{this.postMessage(a,f)}catch(g){return void setTimeout(function(){return d(g?g:"post message exception",null)},0)}this.messageMap[e]={origin:a,callback:d}},a}();a.MessageProcessor=c}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function b(a){this._labState=null,this._messages=[],this._initializationInfo=null,this._version=a}return b.prototype.getSupportedVersions=function(){return[{version:this._version}]},b.prototype.connect=function(b,c){var d={initializationInfo:this._initializationInfo,hostVersion:{major:0,minor:1},userInfo:{id:"TestUserId",permissions:[a.Core.Permissions.Edit,a.Core.Permissions.Take]},applicationId:"TestAppId",mode:0};setTimeout(function(){return c(null,d)},0)},b.prototype.disconnect=function(a){setTimeout(function(){return a(null,null)},0)},b.prototype.on=function(a){},b.prototype.sendMessage=function(a,b,c){this._messages.push({type:a,options:b,response:null}),setTimeout(function(){return c(null,null)})},b.prototype.getMessages=function(){return this._messages},b.prototype.create=function(b,c){this._initializationInfo={hostVersion:this._version},this._labState=new a.InMemoryLabState,setTimeout(function(){return c(null,null)},0)},b.prototype.verifyLabCreated=function(a){return this._initializationInfo?!0:(setTimeout(function(){return a("Lab has not been created",null)}),!1)},b.prototype.getConfiguration=function(a){if(this.verifyLabCreated(a)){var b=this._labState.getConfiguration();setTimeout(function(){return a(null,b)},0)}},b.prototype.setConfiguration=function(a,b){this.verifyLabCreated(b)&&(this._labState.setConfiguration(a),setTimeout(function(){return b(null,null)},0))},b.prototype.getState=function(a){if(this.verifyLabCreated(a)){var b=this._labState.getState();setTimeout(function(){return a(null,b)})}},b.prototype.setState=function(a,b){this.verifyLabCreated(b)&&(this._labState.setState(a),setTimeout(function(){return b(null,null)},0))},b.prototype.getConfigurationInstance=function(a){if(this.verifyLabCreated(a)){var b=this._labState.getConfigurationInstance();setTimeout(function(){return a(null,b)},0)}},b.prototype.takeAction=function(a,b,c,d){if(this.verifyLabCreated(d)){var e=void 0!==d?d:c,f=void 0!==d?c:null,g=this._labState.takeAction(a,b,f);setTimeout(function(){return e(null,g)},0)}},b.prototype.getActions=function(a,b,c){if(this.verifyLabCreated(c)){var d=this._labState.getActions(a,b);setTimeout(function(){return c(null,d)},0)}},b.prototype.getLanguage=function(){return"en-US"},b}();a.InMemoryLabHost=b}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function b(){this._configuration=null,this._configurationInstance=null,this._state=null,this._actions=[],this._nextId=0,this._componentInstances={}}return b.prototype.getConfiguration=function(){return this._configuration},b.prototype.setConfiguration=function(a){this._configuration=a,this._configurationInstance=null,this._state=null,this._actions=[],this._componentInstances={}},b.prototype.getState=function(){return this._state},b.prototype.setState=function(a){this._state=a},b.prototype.getConfigurationInstance=function(){return this._configurationInstance||(this._configurationInstance=this.getConfigurationInstanceFromConfiguration(this._configuration)),this._configurationInstance},b.prototype.getConfigurationInstanceFromConfiguration=function(a){var b=this;if(!a)return null;var c=a.components.map(function(a){return b.getAndStoreComponentInstanceFromComponent(a)});return{appVersion:a.appVersion,components:c,name:a.name,timeline:a.timeline}},b.prototype.getAndStoreComponentInstanceFromComponent=function(b){var c=JSON.parse(JSON.stringify(b)),d=this._nextId++;if(c.componentId=d.toString(),b.type===a.Components.ChoiceComponentType)c.type=a.Components.ChoiceComponentInstanceType;else if(b.type===a.Components.InputComponentType)c.type=a.Components.InputComponentInstanceType;else if(b.type===a.Components.ActivityComponentType)c.type=a.Components.ActivityComponentInstanceType;else{if(b.type!==a.Components.DynamicComponentType)throw"unknown type";c.type=a.Components.DynamicComponentInstanceType}for(var e in c.values)for(var f=c.values[e],g=0;g<f.length;g++){var h=this._nextId++;f[g].valueId=h.toString()}return this._componentInstances[c.componentId]={component:b,instance:c},c},b.prototype.takeAction=function(a,b,c){return this.takeActionCore(a,b,c)},b.prototype.takeActionCore=function(b,c,d){if(null===d){if(b===a.Core.Actions.CreateAttemptAction){var e=this._nextId++,f={attemptId:e.toString()};d=f}else if(b===a.Core.Actions.GetValueAction){var g=c,h={value:this.findConfigurationValue(g.componentId,g.attemptId,g.valueId)};d=h}else if(b===a.Core.Actions.CreateComponentAction){var i=c,j=this.getAndStoreComponentInstanceFromComponent(i.component),k={componentInstance:j};d=k}else if(b===a.Core.Actions.SubmitAnswerAction){var l=this._nextId++,m={submissionId:l.toString(),complete:!0,score:null};d=m}}else if(b===a.Core.Actions.SubmitAnswerAction){var l=this._nextId++,n=d;n.submissionId=l.toString()}var o={type:b,options:c,result:d,time:Date.now()};return this._actions.push(o),o},b.prototype.findConfigurationValue=function(a,b,c){var d=this._componentInstances[a];if(d)for(var e in d.instance.values)for(var f=d.instance.values[e],g=0;g<f.length;g++)if(f[g].valueId===c)return d.component.values[e][g].value;throw"not found"},b.prototype.getAllActions=function(){return this._actions},b.prototype.setActions=function(a){this._actions=a},b.prototype.getActions=function(b,c){var d,e,f=[];if(b===a.Core.GetActions.GetAttempt){var g=c;for(d=0;d<this._actions.length;d++)e=this._actions[d],e.options.attemptId===g.attemptId&&f.push(e)}else{if(b!==a.Core.GetActions.GetComponentActions)throw"Unknown get results action";var h=c;for(d=0;d<this._actions.length;d++)e=this._actions[d],e.type===h.action&&e.options.componentId===h.componentId&&f.push(e)}return f},b}();a.InMemoryLabState=b}(Labs||(Labs={}));var Office,Labs;!function(a){var b=function(){function a(){var a=this;this._callbacks=[],this._isResolved=!1,this.promise={then:function(b){a._callbacks.push(b),a._isResolved&&a.fireCallbacks()}}}return a.prototype.resolve=function(a){this._isResolved=!0,this._resolvedValue=a,this.fireCallbacks()},a.prototype.fireCallbacks=function(){var a=this;this._callbacks.forEach(function(b){b(a._resolvedValue)}),this._callbacks=[]},a}();a.Resolver=b;var c=function(){function c(){var d=this;this._version={version:{major:0,minor:1}};var e=new b;this._officeInitialized=e.promise,Office.initialize=function(){var b=Office.context.document.settings.get(c.SettingsKeyName);d._labHost=b&&b.published?new a.PostMessageLabHost(b.publishedAppId,parent.parent,"*"):new a.RichClientOfficeJSLabsHost(b?b.configuration:null,b?b.hostVersion:null),e.resolve()}}return c.prototype.getSupportedVersions=function(){return[this._version]},c.prototype.connect=function(a,b){var c=this;this._officeInitialized.then(function(){c._labHost.connect(a,b)})},c.prototype.disconnect=function(a){this._labHost.disconnect(a)},c.prototype.on=function(a){this._labHost.on(a)},c.prototype.sendMessage=function(a,b,c){this._labHost.sendMessage(a,b,c)},c.prototype.create=function(a,b){this._labHost.create(a,b)},c.prototype.getConfiguration=function(a){this._labHost.getConfiguration(a)},c.prototype.setConfiguration=function(a,b){this._labHost.setConfiguration(a,b)},c.prototype.getConfigurationInstance=function(a){this._labHost.getConfigurationInstance(a)},c.prototype.getState=function(a){this._labHost.getState(a)},c.prototype.setState=function(a,b){this._labHost.setState(a,b)},c.prototype.takeAction=function(a,b,c,d){this._labHost.takeAction(a,b,c,d)},c.prototype.getActions=function(a,b,c){this._labHost.getActions(a,b,c);

},c.prototype.getLanguage=function(){return this._labHost.getLanguage()},c.SettingsKeyName="__labs__",c}();a.OfficeJSLabHost=c}(Labs||(Labs={})),Labs.DefaultHostBuilder=function(){return new Labs.OfficeJSLabHost};var Labs;!function(a){var b;!function(a){a[a.Reject=0]="Reject",a[a.Collecting=1]="Collecting",a[a.Firing=2]="Firing"}(b||(b={}));var c=function(){function b(b,c,d){var e=this;this._handlers=[],this._version={version:{major:0,minor:1}},this._state=0,this._deferredEvents=[],this._targetWindow=c,this._messageProcessor=new a.MessageProcessor(b,d,function(a,b,c){a==e._targetWindow&&e.handleEvent(b,c)})}return b.prototype.handleEvent=function(a,b){0==this._state?b("Message received prior to connection",null):1==this._state?this._deferredEvents.push({command:a,callback:b}):this.invokeEvent(null,a,b)},b.prototype.invokeDeferredEvents=function(a){var b=this;this._deferredEvents.forEach(function(c){b.invokeEvent(a,c.command,c.callback)}),this._deferredEvents=[]},b.prototype.invokeEvent=function(a,b,c){a||this._handlers.map(function(a){a(b.type,b.commandData)}),c(a,null)},b.prototype.getSupportedVersions=function(){return[this._version]},b.prototype.connect=function(b,c){var d=this;this._messageProcessor.start(),this._state=1;var e=new a.Command(a.CommandType.Connect,this._version);this._messageProcessor.sendMessage(this._targetWindow,e,function(a,b){b.hostVersion.major!==d._version.version.major&&(a="Unsupported post message host"),setTimeout(function(){c(a,b),d.invokeDeferredEvents(a),d._state=a?0:2},0)})},b.prototype.disconnect=function(b){var c=this;this._state=0;var d=new a.Command(a.CommandType.Disconnect,null);this._messageProcessor.sendMessage(this._targetWindow,d,function(a,d){c._messageProcessor.stop(),b(a,d)})},b.prototype.on=function(a){this._handlers.push(a)},b.prototype.sendMessage=function(b,c,d){var e={type:b,options:c},f=new a.Command(a.CommandType.SendMessage,e);this.sendCommand(f,d)},b.prototype.create=function(b,c){var d=new a.Command(a.CommandType.Create,b);this.sendCommand(d,c)},b.prototype.getConfiguration=function(b){var c=new a.Command(a.CommandType.GetConfiguration);this.sendCommand(c,b)},b.prototype.setConfiguration=function(b,c){var d=new a.Command(a.CommandType.SetConfiguration,b);this.sendCommand(d,c)},b.prototype.getConfigurationInstance=function(b){var c=new a.Command(a.CommandType.GetConfigurationInstance);this.sendCommand(c,b)},b.prototype.getState=function(b){var c=new a.Command(a.CommandType.GetState);this.sendCommand(c,b)},b.prototype.setState=function(b,c){var d=new a.Command(a.CommandType.SetState,b);this.sendCommand(d,c)},b.prototype.takeAction=function(b,c,d,e){var f={type:b,options:c,result:void 0!==e?d:null},g=new a.Command(a.CommandType.TakeAction,f);this.sendCommand(g,void 0!==e?e:d)},b.prototype.getActions=function(b,c,d){var e={type:b,options:c},f=new a.Command(a.CommandType.GetCompletedActions,e);this.sendCommand(f,d)},b.prototype.getLanguage=function(){return"en-US"},b.prototype.sendCommand=function(a,b){this._messageProcessor.sendMessage(this._targetWindow,a,b)},b}();a.PostMessageLabHost=c}(Labs||(Labs={}));var Labs;!function(a){var b=function(){function b(b,c){var d=this;this._handlers=[],this._version={version:{major:0,minor:1}},this._labState=null,this._configurationInfo=null,c?(this._createdHostVersion=c,this._configurationInfo={hostVersion:this._createdHostVersion},this._labState=new a.InMemoryLabState,this._labState.setConfiguration(b),this._createdHostVersion=c):(this._configurationInfo=null,this._createdHostVersion=null);var e=new a.Resolver;Office.context.document.getActiveViewAsync(function(a){d._activeMode=d.getLabModeFromActiveView(a.value),e.resolve(a.value)}),this._activeViewP=e.promise,Office.context.document.addHandlerAsync("activeViewChanged",function(b){d._activeMode=d.getLabModeFromActiveView(b.activeView),d._handlers.forEach(function(b){b(a.CommandType.ModeChanged,{mode:a.Core.LabMode[d._activeMode]})})})}return b.prototype.getLabModeFromActiveView=function(a){return"edit"===a?0:1},b.prototype.getSupportedVersions=function(){return[this._version]},b.prototype.connect=function(b,c){var d=this;this._activeViewP.then(function(){var b={initializationInfo:d._configurationInfo,hostVersion:{major:0,minor:1},userInfo:{id:"TestUserId",permissions:[a.Core.Permissions.Edit,a.Core.Permissions.Take]},applicationId:"TestAppId",mode:d._activeMode};setTimeout(function(){return c(null,b)},0)})},b.prototype.disconnect=function(a){setTimeout(function(){return a(null,null)},0)},b.prototype.on=function(a){this._handlers.push(a)},b.prototype.sendMessage=function(b,c,d){if(b===a.TimelineNextMessageType){var e=Office.Index.Next;Office.context.document.goToByIdAsync(e,Office.GoToType.Index,function(a){var b=null;a.status==Office.AsyncResultStatus.Failed&&(b=a.error),setTimeout(function(){return d(b,null)},0)})}else setTimeout(function(){return d("unknown message",null)},0)},b.prototype.verifyLabCreated=function(a){return this._configurationInfo?!0:(setTimeout(function(){return a("Lab has not been created",null)}),!1)},b.prototype.create=function(b,c){this._createdHostVersion=this._version.version,this._configurationInfo={hostVersion:this._createdHostVersion},this._labState=new a.InMemoryLabState,this._labState.setConfiguration(null),this.updateStoredLabsState(c)},b.prototype.getConfiguration=function(a){var b=this;this.verifyLabCreated(a)&&setTimeout(function(){return a(null,b._labState.getConfiguration())},0)},b.prototype.setConfiguration=function(a,b){this.verifyLabCreated(b)&&(this._labState.setConfiguration(a),this.updateStoredLabsState(b))},b.prototype.updateStoredLabsState=function(b){var c={configuration:this._labState.getConfiguration(),hostVersion:this._createdHostVersion};Office.context.document.settings.set(a.OfficeJSLabHost.SettingsKeyName,c),Office.context.document.settings.saveAsync(function(a){setTimeout(function(){return b(a.status===Office.AsyncResultStatus.Failed?a.status:null,null)},0)})},b.prototype.getConfigurationInstance=function(a){var b=this;this.verifyLabCreated(a)&&setTimeout(function(){return a(null,b._labState.getConfigurationInstance())})},b.prototype.getState=function(a){var b=this;this.verifyLabCreated(a)&&setTimeout(function(){return a(null,b._labState.getState())})},b.prototype.setState=function(a,b){this.verifyLabCreated(b)&&(this._labState.setState(a),setTimeout(function(){return b(null,null)}))},b.prototype.takeAction=function(a,b,c,d){if(this.verifyLabCreated(d)){var e=void 0!==d?d:c,f=void 0!==d?c:null,g=this._labState.takeAction(a,b,f);setTimeout(function(){return e(null,g)})}},b.prototype.getActions=function(a,b,c){var d=this;this.verifyLabCreated(c)&&setTimeout(function(){return c(null,d._labState.getActions(a,b))})},b.prototype.getLanguage=function(){return Office.context.displayLanguage},b}();a.RichClientOfficeJSLabsHost=b}(Labs||(Labs={}));